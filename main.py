from fastapi import FastAPI
from pydantic import BaseModel
import requests
import random
import json

app = FastAPI(title="Ultra Smart AI API", version="3.0")

class ChatRequest(BaseModel):
    message: str

def get_smart_response(user_input):
    """–£–º–Ω—ã–π AI –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç"""
    
    # 1. –ü—Ä–æ–±—É–µ–º –Ω–æ–≤—ã–π —Ä–∞–±–æ—Ç–∞—é—â–∏–π API
    try:
        response = requests.post(
            "https://chatgpt-api.shn.hk/v1/",  # –†–∞–±–æ—Ç–∞—é—â–∏–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π ChatGPT API
            json={
                "model": "gpt-3.5-turbo",
                "messages": [{"role": "user", "content": user_input}],
                "temperature": 0.7
            },
            timeout=20
        )
        if response.status_code == 200:
            result = response.json()
            return result["choices"][0]["message"]["content"]
    except:
        pass
    
    # 2. –ü—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π API
    try:
        response = requests.post(
            "https://api.openai-proxy.org/v1/chat/completions",
            json={
                "model": "gpt-3.5-turbo", 
                "messages": [{"role": "user", "content": user_input}],
                "temperature": 0.7
            },
            timeout=20
        )
        if response.status_code == 200:
            result = response.json()
            return result["choices"][0]["message"]["content"]
    except:
        pass
    
    # 3. –£–º–Ω—ã–µ –∑–∞–ø–∞—Å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
    return generate_clever_response(user_input)

def generate_clever_response(user_input):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–º–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∫–æ–≥–¥–∞ API –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç"""
    user_lower = user_input.lower()
    
    # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
    if any(word in user_lower for word in ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', 'hello', 'hi']):
        responses = [
            "–ü—Ä–∏–≤–µ—Ç! üëã –Ø —Ç–≤–æ–π AI –ø–æ–º–æ—â–Ω–∏–∫. –†–∞–¥ –æ–±—â–µ–Ω–∏—é! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?",
            "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üòä –Ø –∑–¥–µ—Å—å —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –≤–∞–º. –ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?",
            "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! üöÄ –ì–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã. –°–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ!"
        ]
        return random.choice(responses)
    
    # –í–æ–ø—Ä–æ—Å—ã –æ —Å–µ–±–µ
    elif any(word in user_lower for word in ['–∫—Ç–æ —Ç—ã', '—Ä–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ', '—á—Ç–æ —Ç—ã']):
        responses = [
            "–Ø - —É–º–Ω—ã–π AI –ø–æ–º–æ—â–Ω–∏–∫, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —á—Ç–æ–±—ã –ø–æ–º–æ–≥–∞—Ç—å —Å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –Ω–µ —Ç–æ–ª—å–∫–æ! üíª –ú–æ–≥—É –ø–æ–º–æ—á—å —Å –∫–æ–¥–æ–º, –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏, –∏–¥–µ—è–º–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –º–Ω–æ–≥–∏–º –¥—Ä—É–≥–∏–º.",
            "–Ø –≤–∞—à –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º! ü§ñ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Å—å –Ω–∞ IT —Ç–µ–º–∞—Ö, –Ω–æ –º–æ–≥—É –æ–±—â–∞—Ç—å—Å—è –Ω–∞ –ª—é–±—ã–µ —Ç–µ–º—ã. –í—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–º–æ—á—å!",
            "–Ø AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –≥–æ—Ç–æ–≤—ã–π –ø–æ–º–æ—á—å —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏! üéØ –û—Å–æ–±–µ–Ω–Ω–æ —Å–∏–ª–µ–Ω –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏, –Ω–æ —Ç–∞–∫–∂–µ –º–æ–≥—É –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –±–µ—Å–µ–¥—É –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–µ–º—ã."
        ]
        return random.choice(responses)
    
    # –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
    elif any(word in user_lower for word in ['python', '–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä', '–∫–æ–¥', '–∞–ª–≥–æ—Ä–∏—Ç–º']):
        responses = [
            "–û—Ç–ª–∏—á–Ω–∞—è —Ç–µ–º–∞! üêç Python - –º–æ–π –ª—é–±–∏–º—ã–π —è–∑—ã–∫. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å: –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π (Django, Flask), –∞–Ω–∞–ª–∏–∑–æ–º –¥–∞–Ω–Ω—ã—Ö, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π, AI/ML –ø—Ä–æ–µ–∫—Ç–∞–º–∏.",
            "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ - —ç—Ç–æ –∑–¥–æ—Ä–æ–≤–æ! üíª –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç: –æ—Å–Ω–æ–≤—ã Python, –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, –∞–ª–≥–æ—Ä–∏—Ç–º—ã, –∏–ª–∏ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ?",
            "IT - –º–æ—è —Å—Ç–∏—Ö–∏—è! üöÄ –ú–æ–≥—É –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –∑–Ω–∞–Ω–∏—è–º–∏ –ø–æ: Python, JavaScript, –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö, –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º, –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏."
        ]
        return random.choice(responses)
    
    # –ü–æ–º–æ—â—å
    elif any(word in user_lower for word in ['–ø–æ–º–æ–≥–∏', '–ø–æ–º–æ—â—å', 'help']):
        return "–ö–æ–Ω–µ—á–Ω–æ! ü§ù –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ: –ø–æ–º–æ—â—å —Å –∫–æ–¥–æ–º, –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–µ–º—ã, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è, –∏–ª–∏ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ? –ë—É–¥—É —Ä–∞–¥ –ø–æ–º–æ—á—å!"
    
    # –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
    else:
        responses = [
            f"–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! ü§î –ü–æ —Ç–µ–º–µ '{user_input}' - —è AI –ø–æ–º–æ—â–Ω–∏–∫ –∏ –º–æ–≥—É –ø–æ–º–æ—á—å —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏. –ú–æ–∂–µ—Ç –±—ã—Ç—å, —Å–ø—Ä–æ—Å–∏—Ç–µ –æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ IT?",
            f"–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–æ–ø—Ä–æ—Å! üí° –Ø —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Å—å –Ω–∞ IT —Ç–µ–º–∞—Ö, –Ω–æ –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –ø–æ–æ–±—â–∞—Ç—å—Å—è. –ú–æ–∂–µ—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å –æ Python, –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏–ª–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö!",
            f"–ü–æ–Ω—è–ª –≤–∞—à –≤–æ–ø—Ä–æ—Å! üéØ –ö–∞–∫ AI –ø–æ–º–æ—â–Ω–∏–∫, —è –ª—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞–∑–±–∏—Ä–∞—é—Å—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å –∫–æ–¥–æ–º, –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏–ª–∏ –æ–±—É—á–µ–Ω–∏–µ–º!"
        ]
        return random.choice(responses)

@app.post("/smart-chat")
async def smart_chat(request: ChatRequest):
    """–£–º–Ω—ã–π —á–∞—Ç –∫–æ—Ç–æ—Ä—ã–π –í–°–ï–ì–î–ê –æ—Ç–≤–µ—á–∞–µ—Ç"""
    user_input = request.message
    
    print(f"üí¨ –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å: {user_input}")
    
    # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç AI
    ai_response = get_smart_response(user_input)
    
    return {
        "user_message": user_input,
        "ai_response": ai_response,
        "source": "Ultra Smart AI",
        "type": "smart_chat",
        "status": "success"
    }

@app.post("/chat")
async def simple_chat(request: ChatRequest):
    """–ü—Ä–æ—Å—Ç–æ–π —á–∞—Ç –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏"""
    return await smart_chat(request)

@app.get("/")
def home():
    return {
        "message": "üöÄ ULTRA SMART AI API –†–ê–ë–û–¢–ê–ï–¢!",
        "version": "3.0", 
        "status": "active",
        "features": "–í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç, –£–º–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, –ú—É–ª—å—Ç–∏-API",
        "endpoints": {
            "POST /smart-chat": "–£–º–Ω—ã–π AI (–≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç)",
            "POST /chat": "–ü—Ä–æ—Å—Ç–æ–π —á–∞—Ç",
            "GET /": "–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞"
        }
    }

@app.get("/health")
def health_check():
    return {
        "status": "healthy",
        "service": "Ultra Smart AI API", 
        "version": "3.0",
        "ai_system": "Multi-API + Smart Fallback"
    }

@app.get("/test")
def test_chat():
    """–¢–µ—Å—Ç–æ–≤—ã–π endpoint"""
    test_response = get_smart_response("–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?")
    return {
        "test_message": "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?",
        "ai_response": test_response,
        "status": "working"
    }

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
